# NautilusTrader POC Configuration
nautilus_poc:
  # Environment settings - can be overridden via NAUTILUS_ENVIRONMENT
  environment: "testnet"          # "testnet" or "mainnet"
  
  # Multi-environment configurations
  environments:
    testnet:
      solana:
        network: "testnet"
        rpc_endpoint: "https://api.testnet.solana.com"
        commitment: "confirmed"
        cluster: "testnet"
      pumpswap:
        max_slippage_percent: 10.0    # Higher slippage tolerance for testnet
        base_position_size: 0.01      # Smaller positions for testing
        max_position_size: 0.1        # Conservative max for testnet
        min_liquidity_sol: 1.0        # Lower liquidity requirement for testnet
        max_price_impact_percent: 15.0 # Higher impact tolerance for testing
        realistic_transaction_cost: 0.001  # 10 bps for testnet
      security:
        validate_token_addresses: true
        require_transaction_confirmation: true
        enable_circuit_breaker: true
        max_daily_trades: 100
        wallet_balance_alert_threshold: 0.1  # Alert when below 0.1 SOL
      
    mainnet:
      solana:
        network: "mainnet"
        rpc_endpoint: "https://api.mainnet-beta.solana.com"
        commitment: "finalized"
        cluster: "mainnet-beta"
      pumpswap:
        max_slippage_percent: 5.0     # Stricter slippage for mainnet
        base_position_size: 0.1       # Standard position size
        max_position_size: 0.5        # Higher max for mainnet
        min_liquidity_sol: 10.0       # Higher liquidity requirement
        max_price_impact_percent: 10.0 # Stricter impact tolerance
        realistic_transaction_cost: 0.0005  # 5 bps for mainnet
      security:
        validate_token_addresses: true
        require_transaction_confirmation: true
        enable_circuit_breaker: true
        max_daily_trades: 500
        wallet_balance_alert_threshold: 1.0  # Alert when below 1.0 SOL
  
  # Q50 Signal Configuration
  q50:
    features_path: "data3/macro_features.pkl"  # Path to Q50 signals file
    signal_tolerance_minutes: 5     # Tolerance for timestamp matching
    required_columns:               # Required Q50 columns for validation
      - "q10"
      - "q50" 
      - "q90"
      - "vol_raw"
      - "vol_risk"
      - "prob_up"
      - "economically_significant"
      - "high_quality"
      - "tradeable"
    backup_features_path: ""        # Optional backup path for signals
    signal_cache_ttl_minutes: 60    # Cache TTL for loaded signals
  
  # Wallet and Security Configuration (set via environment variables)
  wallet:
    # These should NEVER be set in config file - use environment variables only
    payer_public_key: ""           # Set via NAUTILUS_PAYER_PUBLIC_KEY
    private_key_path: ""           # Set via NAUTILUS_PRIVATE_KEY_PATH
    private_key_env_var: ""        # Set via NAUTILUS_PRIVATE_KEY_ENV_VAR
    wallet_password_env_var: ""    # Set via NAUTILUS_WALLET_PASSWORD_ENV_VAR
    
    # Wallet validation settings
    validate_balance_before_trade: true
    min_balance_sol: 0.1           # Minimum balance to maintain
    balance_check_interval_minutes: 5
    
  # Trading Parameters (environment-specific overrides applied)
  trading:
    # Position sizing
    kelly_multiplier: 1.0          # Kelly criterion multiplier
    max_portfolio_risk: 0.2        # Maximum portfolio risk (20%)
    position_concentration_limit: 0.1  # Max 10% in single position
    
    # Execution parameters
    order_timeout_seconds: 30      # Order execution timeout
    confirmation_timeout_seconds: 60  # Transaction confirmation timeout
    max_gas_price_lamports: 5000   # Maximum gas price willing to pay
    
    # Risk management
    stop_loss_percent: 20.0        # Automatic stop loss threshold
    take_profit_percent: 50.0      # Take profit threshold
    position_timeout_hours: 24     # Maximum holding period
    max_consecutive_losses: 5      # Circuit breaker trigger
    
  # NautilusTrader Configuration
  nautilus:
    instance_id: "NAUTILUS-001"    # Unique instance identifier
    log_level: "INFO"              # Logging level
    cache_database_path: "cache.db" # Cache database path
    
    # Strategy configuration
    strategy_config:
      risk_engine_config:
        bypass: false              # Enable risk engine
        max_order_rate: "100/00:00:01"  # Max orders per second
        max_notional_per_order: 1000000  # Max notional per order
      
      exec_engine_config:
        reconciliation: true       # Enable position reconciliation
        inflight_check_interval_ms: 5000  # Check interval for inflight orders
        
    # Data engine configuration
    data_engine_config:
      time_bars_build_with_no_updates: false
      time_bars_timestamp_on_close: true
      validate_data_sequence: true
    
  # Performance Monitoring
  monitoring:
    enable_performance_tracking: true
    log_signal_processing: true
    log_trade_execution: true
    log_pumpswap_interactions: true
    log_wallet_operations: true
    log_security_events: true
    
    # Metrics collection
    collect_execution_metrics: true
    collect_pnl_metrics: true
    collect_slippage_metrics: true
    metrics_export_interval_minutes: 15
    
    # Performance thresholds
    signal_processing_timeout_ms: 1000
    trade_execution_timeout_ms: 30000
    max_acceptable_slippage_percent: 5.0
    
  # Error Handling and Recovery
  error_handling:
    max_retries: 3
    retry_delay_base: 1.0
    retry_delay_max: 60.0
    circuit_breaker_threshold: 5
    circuit_breaker_timeout: 300
    
    # Specific error handling
    rpc_error_retry_count: 5
    rpc_error_backoff_factor: 2.0
    pumpswap_error_retry_count: 3
    wallet_error_retry_count: 2
    
    # Recovery strategies
    enable_graceful_degradation: true
    fallback_to_hold_on_error: true
    auto_restart_on_critical_error: false
    
  # Security Configuration
  security:
    # Token validation
    validate_token_addresses: true
    token_blacklist_path: "security/token_blacklist.json"
    token_whitelist_path: "security/token_whitelist.json"
    enable_token_metadata_validation: true
    
    # Transaction security
    require_transaction_confirmation: true
    max_transaction_retries: 3
    transaction_signature_validation: true
    
    # Operational security
    enable_audit_logging: true
    audit_log_path: "logs/security_audit.log"
    sensitive_data_masking: true
    
    # Rate limiting for security
    max_trades_per_minute: 10
    max_trades_per_hour: 100
    max_trades_per_day: 500
    
  # Regime Detection
  regime_detection:
    vol_risk_percentiles:
      low: 0.30
      high: 0.70
      extreme: 0.90
    regime_multipliers:
      low_variance: 0.7
      medium_variance: 1.0
      high_variance: 1.4
      extreme_variance: 1.8
    
    # Adaptive thresholds
    enable_adaptive_thresholds: true
    threshold_adjustment_factor: 0.1
    min_threshold_adjustment: -0.5
    max_threshold_adjustment: 1.0